---
title: "Early-warnings signals in ecological systems Sesi√≥n 3"
author: "Roberto √Ålvarez.  Universidad Aut√≥noma de Quer√©taro"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: 
    fig_height: 8
    fig_width: 13
    number_section: yes
    theme: cerulean
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
editor_options: 
  markdown: 
    wrap: 72
---

# M√©tricas alternativas de estabilidad



Este tutorial presenta **m√©tricas de estabilidad** que
son **distintas** a las se√±ales de alerta temprana (EWS, por sus siglas
en ingl√©s) basadas en el **fen√≥meno de desaceleraci√≥n
cr√≠tica** (*critical slowing down*, CSD). Es decir, **no se enfocan en
detectar transiciones cr√≠ticas observando c√≥mo el sistema se vuelve m√°s
lento para recuperarse ante perturbaciones**.

Lo que hace valioso a este conjunto de t√©cnicas es que **no retraduccn
que el sistema est√© en equilibrio**, ni tampoco**suponen ning√∫n modelo
matem√°tico subyacente espec√≠fico**. Esto las vuelve especialmente √∫tiles
para analizar sistemas reales complejos, donde a menudo **no se conoce
bien el modelo din√°mico **o** el sistema est√° en constante cambio**, sin
alcanzar un punto estable.

El paquete `EWSmethods` en R ofrece **tres enfoques diferentes** para
cuantificar la estabilidad de un sistema a partir de datos de series de
tiempo, **independientemente de que haya o no una transici√≥n cr√≠tica
inminente**.\
A lo largo del tutorial se explicar√° cada uno de estos m√©todos, paso a
paso, y se incluir√°n ejemplos pr√°cticos para mostrar c√≥mo se aplican.

------------------------------------------------------------------------

-   Mientras que las EWS tradicionales buscan detectar **transiciones
    cr√≠ticas** (como el colapso de un lago o un cambio brusco en una
    poblaci√≥n) mediante indicadores como la varianza, la
    autocorrelaci√≥n, etc.,**estos m√©todos alternativos de estabilidad
    pueden evaluar la resiliencia del sistema sin que se est√© acercando
    necesariamente a un tipping point**.

-   Al ser **modelo-libre** (*model-free*)
    y **equilibrio-libre** (*equilibrium-free*), estos m√©todos pueden
    aplicarse a sistemas:

    -   Que est√°n lejos del equilibrio.

    -   Con m√∫ltiples forzamientos externos.

    -   En los que no se pueden definir bien las variables de estado ni
        las tasas de cambio.

```{r}
library(EWSmethods) # Aseg√∫rate de tenerlo instalado
library(ggplot2) # Para visualizaci√≥n)
data("simTransComms") # Carga el objeto en memoria

# Explora r√°pidamente su estructura
str(simTransComms)

# Por ejemplo, veamos las primeras filas de la primera r√©plica
head(simTransComms$community1)

```

```{r}
matplot(simTransComms$community1[,3:7], type = "l", xlab = "Time", ylab = "Density",  main = "Transitioning five species community")
abline(v=simTransComms$community1$inflection_pt,col = "grey60", lty = "dashed")
```

Ahora que contamos con un sistema (o comunidad) que est√° siendo sometido
a **alg√∫n tipo de perturbaci√≥n o estr√©s**, podemos aplicar**m√©tricas de
estabilidad**, tanto univariadas como multivariadas, para evaluar **c√≥mo
responde el sistema**a esa presi√≥n externa.

Estas m√©tricas no necesariamente detectan una transici√≥n cr√≠tica en s√≠
misma, pero nos dan pistas sobre **la p√©rdida progresiva de estabilidad
o resiliencia**, lo cual puede preceder a un cambio abrupto en la
din√°mica del sistema.

## √çNDICE DE VARIABILIDAD MULTIVARIADO (MVI)

Una de las m√©tricas m√°s simples incluidas en`EWSmethods`es el **√≠ndice
de variabilidad multivariado (MVI, por sus siglas en ingl√©s)**,
propuesto por **Brock y Carpenter (2006)**.

**¬øQu√© mide exactamente?**\
El **MVI** se define como la **ra√≠z cuadrada del valor propio
dominante** (el mayor) de la **matriz de covarianza** de todas las
especies en la comunidad.

-   La matriz de covarianza refleja **c√≥mo var√≠an las especies en
    conjunto**.

-   El valor propio dominante captura la **direcci√≥n de m√°xima varianza
    conjunta**.

-   Al tomar la ra√≠z cuadrada, se obtiene una m√©trica directa de
    variabilidad general del sistema.
    
    
Sea $\mathbf{X} = \begin{bmatrix} X_1 \\ X_2 \\ \vdots \\ X_n \end{bmatrix}$ un vector aleatorio de $n$ variables aleatorias.  


La \textbf{matriz de varianza-covarianza} (o matriz de covarianzas) se define como:

\[
\mathbf{\Sigma} = \mathrm{Cov}(\mathbf{X}) = 
\begin{bmatrix}
\mathrm{Var}(X_1) & \mathrm{Cov}(X_1, X_2) & \cdots & \mathrm{Cov}(X_1, X_n) \\
\mathrm{Cov}(X_2, X_1) & \mathrm{Var}(X_2) & \cdots & \mathrm{Cov}(X_2, X_n) \\
\vdots & \vdots & \ddots & \vdots \\
\mathrm{Cov}(X_n, X_1) & \mathrm{Cov}(X_n, X_2) & \cdots & \mathrm{Var}(X_n)
\end{bmatrix}
\]    

------------------------------------------------------------------------

### **¬øC√≥mo interpretar el MVI?**

-   Si el **MVI aumenta con el tiempo**, eso **sugiere una disminuci√≥n
    de la estabilidad** del sistema.

-   En otras palabras, el sistema comienza a fluctuar m√°s y de forma m√°s
    sincronizada entre especies, lo cual es una se√±al de que **la
    comunidad puede estar acerc√°ndose a una transici√≥n o p√©rdida de
    resiliencia**.

```{r}
egMVI <- mvi(data = simTransComms$community1[,2:7], winsize = 25)
```

```{r}
mvi_plot_data <- merge(simTransComms$community1,as.data.frame(egMVI),by="time") # combine the mvi data with the raw time series

ggplot(mvi_plot_data,aes(x = time, y = mvi)) + geom_line() + geom_vline(xintercept = mvi_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("MVI value")
```

El √≠ndice MVI mide **√∫nicamente cu√°nta variaci√≥n hay en el sistema**,
pero **no detecta si las interacciones entre las especies est√°n
cambiando**. Por eso, este indicador tiene algunas limitaciones
importantes:

-   Es **sensible a la calidad de los datos** (por ejemplo, errores de
    muestreo o falta de resoluci√≥n temporal).

-   Puede verse afectado por la **aleatoriedad natural** del sistema
    (ruido ecol√≥gico real).

-   Su desempe√±o puede empeorar si el **forzamiento externo** (por
    ejemplo, una invasi√≥n, cambio clim√°tico, etc.) es **demasiado
    r√°pido**.

## **Jacobianos estimados por S-map (S-MAP Jacobians)**

### Introducci√≥n conceptual:

Estamos entrando en lo m√°s reciente del an√°lisis de estabilidad.\
Estas herramientas est√°n basadas en el enfoque de **modelado din√°mico
emp√≠rico (EDM)** desarrollado por Sugihara y col. (2012).

La idea central de EDM se apoya en el **teorema de Takens (1981)**:

> *Es posible reconstruir la din√°mica latente de un sistema (su
> atractor) a partir de una o m√°s series de tiempo relacionadas.*

### ¬øC√≥mo se hace?

A trav√©s de una t√©cnica llamada **"lag embedding"**, se construyen
versiones desplazadas en el tiempo de las series originales. A partir de
esas ‚Äúcopias‚Äù, el algoritmo **S-map** estima directamente **la matriz
Jacobiana local**‚Äî una representaci√≥n del comportamiento del sistema en
ese instante.

### ¬øY qu√© nos dice la matriz Jacobiana?

-   Contiene las **derivadas parciales de primer orden**: describe c√≥mo
    **cada variable (especie)** afecta a las dem√°s.

-   A trav√©s de sus **autovalores** (eigenvalues), obtenemos una medida
    de **estabilidad local** conocida como **estabilidad de Lyapunov**.

```{r}
eg_uniJI <- uniJI(data = simTransComms$community1[,2:3], winsize = 25, E = 3)

```

```{r}
uniJI_plot_data <- merge(simTransComms$community1,eg_uniJI,by="time") # combine the mvi data with the raw time series

ggplot(uniJI_plot_data,aes(x = time, y = smap_J)) + geom_line() + geom_vline(xintercept = uniJI_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("Univariate stability index value")
```

Para todas las especies, el √≠ndice de estabilidad univariada se puede
ver en la siguiente gr√°fica

```{r}
all_spp_uniJI <- sapply(grep("spp_",colnames(simTransComms$community1)),FUN = function(x){
  if(x == 3){
  uniJI(data = simTransComms$community1[,c(2,x)], winsize = 25, E = 3)
  }else{
  uniJI(data = simTransComms$community1[,c(2,x)], winsize = 25, E = 3)[,2]
  }
  }) # for each species, calculate the univariate stability index

all_spp_uniJI <- do.call("cbind",all_spp_uniJI) # merge the list in to a data.frame
names(all_spp_uniJI) <- c("time",paste("spp",1:5,sep="_")) # and rename missing columns

all_spp_plot_data <- merge(stats::reshape(data = all_spp_uniJI,
        direction = "long",
        varying = colnames(all_spp_uniJI)[-1],
        v.names = "smap_J",
        times = colnames(all_spp_uniJI)[-1],
        timevar = "species"),
      simTransComms$community1[,c("time","inflection_pt")], by = "time") #pivot_longer for easier plotting and merge with the inflection point data

ggplot(all_spp_plot_data,aes(x = time, y = smap_J)) + geom_line(aes(col=species)) + geom_vline(xintercept = all_spp_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("Univariate stability index value") + scale_colour_manual(values = c("black","#6886c4","#bfbd3d","#69c756","#e281fe")) + facet_wrap(~species)
```

Este enfoque permite observar **c√≥mo responde cada especie de forma
√∫nica** a los cambios en el sistema.\
Al hacerlo, podemos **identificar cu√°les especies son las m√°s
sensibles**, es decir, aquellas que reaccionan m√°s r√°pido o m√°s fuerte a
perturbaciones. Estas especies pueden considerarse **especies
indicadoras**, ya que reflejan de forma temprana la p√©rdida de
estabilidad en toda la comunidad.

### Implicaci√≥n ecol√≥gica:

-   Una especie con alta sensibilidad puede **anticipar una transici√≥n
    cr√≠tica** antes que otras.

-   Esto es clave para **monitoreo ecol√≥gico**: en lugar de seguir a
    toda la comunidad, podr√≠as enfocarte en unas cuantas especies clave.

### ¬øQu√© hace`multiJI()`?

-   Esta funci√≥n estima un **modelo local lineal multivariado**, donde
    todas las especies se usan para **reconstruir el espacio de
    estados** del sistema.

-   A partir de ah√≠, predice el siguiente estado de la comunidad.

-   Los **coeficientes del modelo** sirven como **proxies
    (aproximaciones)** de las **fuerzas de interacci√≥n** entre especies.

üîó Esto permite inferir **c√≥mo influye cada especie sobre las dem√°s**,
sin necesidad de saber las ecuaciones que gobiernan el sistema.

------------------------------------------------------------------------

## Diferencias clave respecto a `uniJI()`

| Aspecto | `uniJI()` | `multiJI()` |
|------------------------|------------------------|------------------------|
| Datos | Una sola especie | Todas las especies |
| Medida | Estabilidad propia (autorregulaci√≥n) | Estabilidad del sistema completo |
| Embedding | Definido por`E`y`tau` | No se usa`E`ni`tau` |
| Autoreferencia (lag) | S√≠ (embedding temporal) | No (embedding por especies) |

------------------------------------------------------------------------

## Detalles t√©cnicos

### `E`y`tau`:

-   **No se requieren en`multiJI()`**. En lugar de eso:

    -   **El n√∫mero de especies**sirve como dimensi√≥n de embedding.

    -   Esto implica que**la serie temporal debe tener al menos tantas
        observaciones como especies**(si tienes 5 especies, m√≠nimo 5
        puntos de tiempo).

-   **`tau`se fija en -1**, porque**no hay autoreferencia temporal**(ya
    no es una serie embebida en s√≠ misma, sino una matriz de especies).

### `theta`: el par√°metro clave

-   **`theta`**controla el grado de no-linealidad local:

    -   Valores bajos ‚Üí modelo m√°s ‚Äúglobal‚Äù (poco peso a la cercan√≠a).

    -   Valores altos ‚Üí modelo muy localizado (m√°s peso a estados
        similares).

-   Si no se especifica,`multiJI()`selecciona el `theta`√≥ptimo
    **minimizando el error cuadr√°tico medio de predicci√≥n** (RMSE).

------------------------------------------------------------------------

**Advertencia t√©cnica importante**:\
La funci√≥n `multiJI()` puede ser **considerablemente m√°s lenta** que
otros indicadores de estabilidad/resiliencia incluidos en `EWSmethods`.

Esto se debe a que `multiJI()` realiza m√∫ltiples **cruces entre
especies** para estimar interacciones din√°micas en cada ventana del
an√°lisis, lo cual **aumenta mucho el costo computacional**.

Por lo tanto:

-   **M√°s especies** = m√°s combinaciones a evaluar.

-   **Series de tiempo m√°s largas** = m√°s ventanas a calcular.

-   **Ventanas m√°s peque√±as (`winsize`)** = m√°s evaluaciones (m√°s
    ventanas deslizantes).

Todo esto puede hacer que el an√°lisis tarde desde **varios segundos
hasta minutos**, dependiendo del tama√±o del sistema.

```{r}
eg_multiJI <- multiJI(data = simTransComms$community1[,2:7], winsize = 25)
```

```{r}
multiJI_plot_data <- merge(simTransComms$community1,eg_multiJI,by="time") # combine the mvi data with the raw time series

ggplot(multiJI_plot_data,aes(x = time, y = smap_J)) + geom_line() + geom_vline(xintercept = multiJI_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("Mulivariate stability index value")
```

Para todas la especies

```{r}
all_spp_uniJI <- sapply(grep("spp_",colnames(simTransComms$community1)),FUN = function(x){
  if(x == 3){
  uniJI(data = simTransComms$community1[,c(2,x)], winsize = 25, E = 3)
  }else{
  uniJI(data = simTransComms$community1[,c(2,x)], winsize = 25, E = 3)[,2]
  }
  }) # for each species, calculate the univariate stability index

all_spp_uniJI <- do.call("cbind",all_spp_uniJI) # merge the list in to a data.frame
names(all_spp_uniJI) <- c("time",paste("spp",1:5,sep="_")) # and rename missing columns

all_spp_plot_data <- merge(stats::reshape(data = all_spp_uniJI,
        direction = "long",
        varying = colnames(all_spp_uniJI)[-1],
        v.names = "smap_J",
        times = colnames(all_spp_uniJI)[-1],
        timevar = "species"),
      simTransComms$community1[,c("time","inflection_pt")], by = "time") #pivot_longer for easier plotting and merge with the inflection point data

ggplot(all_spp_plot_data,aes(x = time, y = smap_J)) + geom_line(aes(col=species)) + geom_vline(xintercept = all_spp_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("Univariate stability index value") + scale_colour_manual(values = c("black","#6886c4","#bfbd3d","#69c756","#e281fe")) + facet_wrap(~species)
```

### Consejos pr√°cticos

Para **optimizar el rendimiento**:

-   Usa **ventanas m√°s grandes**si no necesitas tanta resoluci√≥n.

-   Reduce la **cantidad de especies** en tests exploratorios.

-   Usa solo una r√©plica o subset de datos antes de escalar.

-   Correlo primero con `winsize = 50` y sin `theta`para ver el tiempo
    base.

-   Puedes cronometrar el tiempo con `system.time()`en R:

1\. Sensibilidad a **E** y **tau**

Los dos m√©todos S-map son **muy sensibles** a los valores
de **E** (dimensi√≥n de embedding) y **tau** (retardo).

-   Si **E** es demasiado bajo, no capturas la din√°mica; si es demasiado
    alto, sobreajustas y metes ruido.

-   Elegir**tau**inadecuado puede ‚Äúdesenfocar‚Äù la reconstrucci√≥n del
    atractor.

**Tip r√°pido:** usa `simplex()` y `s_map()` (paquete **rEDM**) para
tantear qu√© combinaciones minimizan el error de predicci√≥n antes de
lanzarte al c√°lculo de estabilidad.

### 2. Efectos de estacionalidad o ciclos compartidos

En series **estacionales o c√≠clicas**, los picos compartidos por todas
las especies (por ejemplo primavera-invierno) pueden **inflar
artificialmente** los valores de causalidad y de interacci√≥n estimados.

-   Parecer√° que todas las especies est√°n ‚Äúfuertemente acopladas‚Äù,
    cuando en realidad solo responden al mismo ciclo ambiental.

**Soluci√≥n recomendada (Ushio et al. 2018):**

-   **Eliminar tendencia**:`detrend_ts()`

-   **Eliminar estacionalidad**:`deseason_ts()`

-   Ambas funciones vienen en `EWSmethods`. √ösalas antes
    de `uniJI()` o`multiJI()`.

3\. Escalado / normalizaci√≥n

Para evitar que una especie con abundancia enorme ‚Äúdomine‚Äù el
ajuste,**escala todas las series** a varianza o rango comparables entre si.

-   `uniJI()` y `multiJI()` traen el argumento `scale = TRUE`, que te lo
    resuelve en un paso.

4\. Per√≠odos largos sin cambios

Si alguna especie queda **plana** (sin variaci√≥n) durante un lapso igual
o mayor al tama√±o de la ventana (`winsize`):

-   `uniJI()` devuelve **NA** para esa ventana.

-   `multiJI()` **descarta** la serie problem√°ticas.

**Por qu√© sucede:** el algoritmo necesita calcular derivadas locales;
si todo es constante, la matriz Jacobiana se vuelve singular o
indefinida.

3)**Jacobianos por Autocorrelaci√≥n**

### ¬øQu√© propone este enfoque?

A diferencia de `uniJI()` y `multiJI()`, que se basan en
reconstrucciones no lineales tipo *empirical dynamic modelling*(EDM),
este m√©todo alternativo propuesto por **Williamson y Lenton
(2015)** utiliza un enfoque m√°s cl√°sico y **lineal**:\
**Modelos autorregresivos multivariados de primer orden** (AR(1)).

Este m√©todo:

-   Calcula una **matriz de autocorrelaci√≥n multivariada con rezago
    1**(lag-1) entre las especies.

-   A partir de esa matriz, se obtienen sus **autovalores
    reales** ($a_j$), los cuales est√°n relacionados directamente con
    los **autovalores de la matriz Jacobiana** ($\lambda_j$) se relacionan mediante la f√≥rmula:

#Œªj=1Œîtlog‚Å°(‚à£aj‚à£)Œªj‚Äã=Œît1‚Äãlog(‚à£aj‚Äã‚à£)
$$\lambda_j=\frac{1}{\Delta t}\log|a_j|$$
Aqu√≠:

-   $Œª_j$ = autovalor del Jacobiano ‚Üí nos da **estabilidad local**

-   $a_j$= autovalor de la matriz de autocorrelaci√≥n

-   $\Delta t$= intervalo temporal entre observaciones

------------------------------------------------------------------------

### ¬øY qu√© pasa con $\Delta t$?

En datos simulados lo puedes conocer, pero en datos reales **rara vez sabes el tiempo exacto entre eventos din√°micos reales**.\
Por eso, **`EWSmethods` asume** Œît=1 como valor por defecto, aunque
puedes cambiarlo manualmente si sabes m√°s sobre la frecuencia o el
tiempo de muestreo.

------------------------------------------------------------------------

## üîç Interpretaci√≥n del √≠ndice `multiAR`

Similar al enfoque `multiJI()`, este m√©todo estima una **medida local de
estabilidad de Lyapunov**, **pero con una escala diferente**:

| Valor de `multiAR`  | Interpretaci√≥n                               |
|---------------------|----------------------------------------------|
| `multiAR < 0`       | Estable (las perturbaciones se amortiguan)   |
| `multiAR > 0`       | Inestable (las perturbaciones se amplifican) |
| `multiAR ‚âà 0`       | Transici√≥n cr√≠tica (p√©rdida de estabilidad)  |
| `multiAR`¬†creciente | Se√±al de estr√©s creciente en el sistema      |

**El umbral aqu√≠ es 0** (no 1, como en los Jacobianos EDM). La
interpretaci√≥n es la misma, pero hay que prestar atenci√≥n a esta
diferencia cuando compares enfoques.

```{r}
eg_multiAR <- multiAR(data = simTransComms$community1[,2:7], winsize = 25)
```

```{r}
multiAR_plot_data <- merge(simTransComms$community1,eg_multiAR,by="time") # combine the mvi data with the raw time series

ggplot(multiAR_plot_data,aes(x = time, y = multiAR)) + geom_line() + geom_vline(xintercept = multiAR_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("Mulivariate stability index value")

```

La funci√≥n `multiAR()` presenta **limitaciones similares a las de los
√≠ndices basados en S-map** (`multiJI` y `uniJI`):

-   Es **sensible a la longitud de las series de tiempo**: si las series
    son muy cortas, la estimaci√≥n del √≠ndice puede ser poco confiable o
    incluso fallar.

-   Tambi√©n es sensible a **qu√© especies incluyes**: algunas pueden
    tener m√°s peso en la estimaci√≥n del √≠ndice dependiendo de su
    din√°mica (por ejemplo, si est√°n muy correlacionadas o tienen
    abundancias altas).

**Dato pr√°ctico observado por los autores:**\
Aunque no est√° formalmente especificado, **se ha observado
emp√≠ricamente** que los modelos autorregresivos multivariados
requieren **al menos 16 puntos de tiempo** para funcionar correctamente.

| Criterio | `mvi()` (√çndice de variabilidad) | `multiJI()` (Jacobiano S-map) | `multiAR()` (Jacobiano por autocorrelaci√≥n) |
|----|----|----|----|
| **Modelo asumido** | Ninguno (modelo libre) | Din√°mico no lineal (EDM) | Lineal (modelo AR multivariado) |
| **Captura interacciones** | No | S√≠, expl√≠citamente por S-map |  S√≠, mediante autocorrelaci√≥n multivariada |
| **Estabilidad de Lyapunov** | No (s√≥lo mide varianza conjunta) | S√≠ (autovalores del Jacobiano local) | S√≠ (transformaci√≥n de matriz AR) |
| **Tipo de estabilidad estimada** | Variabilidad como proxy de inestabilidad | Estabilidad local de red no lineal | Estabilidad local de red lineal |
| **Requiere`E` y`tau`** | No | S√≠ (importante afinar) |  No (usa lag fijo) |
| **Sensibilidad a especies planas** | Moderada | Alta (puede dar `NA`o distorsionar resultado) | Alta (necesita variaci√≥n para matriz AR v√°lida) |
| **Tolerancia a series cortas** | Alta (desde \~10 puntos) | Media (ideal ‚â• 25 puntos por ventana) | Baja (m√≠nimo \~16 puntos) |
| **Sensibilidad a estacionalidad/ciclos** | Baja | Alta (requiere *deseason* y*detrend*) | Media |
| **Velocidad de c√°lculo** | Muy r√°pida | Lenta (reconstrucci√≥n + regresi√≥n local) | Muy r√°pida (\~25√ó m√°s r√°pida que `multiJI()`) |
| **Ideal para** | Diagn√≥stico general r√°pido | An√°lisis profundo de interacci√≥n y resiliencia | Evaluaci√≥n √°gil de estabilidad lineal |

### **Recomendaciones seg√∫n situaci√≥n**

#### **Usa `mvi()`si...**

-   Tienes **pocos datos** o series muy ruidosas.

-   Quieres un **an√°lisis exploratorio r√°pido**.

-   Solo necesitas un **term√≥metro general** del sistema, sin inferir
    interacciones espec√≠ficas.

-   Est√°s trabajando con sistemas con **mucha estocasticidad** o datos
    de baja resoluci√≥n.

------------------------------------------------------------------------

#### **Usa `multiJI()` si...**

-   Te interesa estudiar la **red de interacciones** entre especies a lo
    largo del tiempo.

-   El sistema es **no lineal**, o sospechas de cambios sutiles
    dif√≠ciles de capturar con m√©todos cl√°sicos.

-   Est√°s dispuesto a hacer **preprocesamiento (detrend/deseason)** y
    explorar **par√°metros de embedding** (`E`, `tau`).

-   Cuentas con **series largas y buena resoluci√≥n temporal**.

------------------------------------------------------------------------

#### **Usa `multiAR()` si...**

-   Necesitas **velocidad de c√°lculo** (muchas r√©plicas, an√°lisis por
    lotes, etc.).

-   Tienes un sistema **m√°s cercano al comportamiento lineal** (o no
    necesitas precisi√≥n no lineal).

-   Las series son moderadamente largas (**‚â• 16 puntos**) y con buena
    variabilidad.

-   Ya conoces o puedes asumir el **paso temporal Œît** (o aceptas el
    valor por defecto).

------------------------------------------------------------------------

### Consejo extra para an√°lisis comparativo

Puedes usar los **tres √≠ndices sobre la misma comunidad** y:

1.  **Comparar visualmente** su evoluci√≥n a lo largo del tiempo.

2.  Buscar **coincidencias en tendencias crecientes** como evidencia m√°s
    robusta de p√©rdida de resiliencia.

3.  Analizar **d√≥nde divergen** y discutir a qu√© puede deberse (modelo,
    sensibilidad, ruido, tipo de din√°mica).

## 4) **Informaci√≥n de Fisher (FI)**

La **Informaci√≥n de Fisher (FI)** es un concepto cl√°sico de estad√≠stica
(Fisher y Russell, 1922) que cuantifica **cu√°nta informaci√≥n contienen
los datos sobre un par√°metro no observado**.

Este enfoque ha sido adaptado para evaluar la **din√°mica y estabilidad
de sistemas complejos** (Ahmad et al., 2016), bajo la idea de
que **sistemas estables tienden a ser m√°s informativos** y menos
impredecibles.

En `EWSmethods`, se implementa una **versi√≥n simplificada para series de
tiempo discretas** siguiendo la propuesta de Karunanithi et al. (2008),
con la siguiente f√≥rmula:

$$FI \approx 4\sum_{i=1}^m[q_i‚àíq_{i+1}]^2$$

Con:

-   q_i es la **probabilidad estimada** de que el sistema est√© en el ‚Äúestado‚Äù i,

-   m es el **n√∫mero de estados posibles** que puede asumir el sistema.

------------------------------------------------------------------------

### ¬øQu√© significa ‚Äúestado‚Äù en este contexto?

Un ‚Äúestado‚Äù se define **comparando ventanas consecutivas de tiempo** en
los datos multivariados.

-   Si la **diferencia absoluta entre dos ventanas** (en todas las
    especies) **es menor a una referencia de incertidumbre**, entonces
    se consideran **el mismo estado**.

-   Si no, se consideran **estados distintos**.

Esta ‚Äúincertidumbre de referencia‚Äù se define mediante un vector
llamado `sost`, que representa el **tama√±o de los
estados** (*size-of-states*): t√≠picamente es **2 veces la desviaci√≥n
est√°ndar** de cada especie a lo largo de la serie (Karunanithi et al.,
2008).

------------------------------------------------------------------------

## Interpretaci√≥n del √≠ndice FI

Cuando el √≠ndice FI **disminuye**, se interpreta como que **la
estabilidad del sistema tambi√©n est√° disminuyendo**.

¬øPor qu√©? Porque:

-   En sistemas estables, los estados tienden a repetirse ‚Üí alta
    informaci√≥n ‚Üí FI alto.

-   En sistemas inestables, hay m√°s fluctuaci√≥n ‚Üí menos regularidad ‚Üí FI
    bajo.

------------------------------------------------------------------------

```{r}
eg.sost <- t(apply(simTransComms$community1[,3:7], MARGIN = 2, FUN = sd)) # define size-of-states using the standard deviation of each species separately. Must be wide format hence t()

egFI <- FI(data = simTransComms$community1[,2:7], sost =  eg.sost, winsize = 25,winspace = 1, TL = 90)$FI
```

Si graficamos nuevamente el √≠ndice de **Informaci√≥n de Fisher (FI)**,
podemos observar que **hay diferencias claras en la estabilidad antes y
despu√©s del punto de inflexi√≥n**, es decir, el momento en que la
comunidad atraviesa una transici√≥n cr√≠tica.

Tambi√©n es evidente que el **FI comienza a disminuir antes del cambio
repentino**, lo que sugiere una **p√©rdida anticipada de estabilidad**.\
Adem√°s, la **estabilidad no se recupera inmediatamente**, sino **hasta
bastante despu√©s** de que el estr√©s se estabiliza (el cual se mantiene
constante a partir del tiempo **t = 200**).

```{r}
fi_plot_data <- merge(simTransComms$community1,egFI,by="time") # combine the mvi data with the raw time series

ggplot(fi_plot_data,aes(x = time, y = FI)) + geom_line() + geom_vline(xintercept = fi_plot_data$inflection_pt,col = "grey60", linetype = "dashed") + theme_bw() + xlab("Time") + ylab("Fisher Information value")
```
